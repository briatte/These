

\chapter{Étude de la structure d'une archive de courriels en tant que flot de liens}
\minitoc
\chaptermark{Étude d'une archive de courriels}
\label{chap:mailing}

%L'étude de la structure des réseaux est un sujet qui est étudié depuis assez longtemps \REF.
%Ces études ont, dans un premier temps, permis de trouver comment caractériser une structure puis, dans un second temps, de proposer des méthodes de détections de ces structures.

Nous nous intéressons ici à une archive de courriels disponible publiquement\,\footnote{\url{https://lists.debian.org/debian-user/}}.
Cette archive contient l'ensemble des courriels échangés par différents utilisateurs pour résoudre un problème survenu lors de l'utilisation de Debian.
Une personne rencontrant un problème lors de l'installation envoie un courriel à la liste afin de demander de l'aide.
Toute personne inscrite sur la liste reçoit ce courriel et peut y répondre, ce qui donne lieu à une discussion visible par tous.
Ces discussions ont déjà été étudiées dans le passé~\cite{dorat2007,sowe2006,wang2014} mais par l'utilisation de méthodes statiques uniquement.

Or, ces données se représentent naturellement sous forme de flot de liens en associant chaque personne à un n\oe{}ud et chaque courriel entre deux personnes à un lien dans le flot de liens à l'instant où le courriel a été envoyé.
Comme un courriel n'a pas de durée, nous représentons, par abus de notations, un lien par le triplet $(t,u,v)$ au lieu de $(t,t,u,v)$.
L'avantage de ces données de communications est que nous connaissons la discussion (\emph{thread}) dans laquelle a lieu chaque message.
Une discussion est un ensemble de courriels dont tous les messages répondent à un message précédent de la discussion excepté pour le premier qui est la racine de la discussion et qui ne répond à personne.
Ainsi, nous étudions la structure des discussions dans le flot liens représentant les courriels envoyés sur la liste.

Utiliser le formalisme de flot de liens est particulièrement intéressant car cette liste de diffusion existe depuis 1994.
L'aspect temporel des discussions est donc important.



\section{Pré-traitement sur le jeu de données}
Bien qu'accessible sur internet, ce jeu de données nécessite un ensemble de traitements avant de pouvoir exploiter les $724\ 985$ courriels que contenait l'archive en janvier 2015.
Tout d'abord, les données accessibles par le site internet ne sont pas  structurées sous la forme d'un flot de liens avec la structure des conversations.
Pour avoir ces informations sous la forme d'un flots de liens, un script d'extraction a été développé\,\footnote{\url{https://bitbucket.org/nGaumont/mailarchiver}}.
Lors de l'extraction, $2\ 269$ courriels n'ont pas pu être pris en compte car certaines informations étaient manquantes ou mal formées, typiquement à cause de la date ou d'un fuseau horaire non reconnu.

Une fois les informations brutes récupérées, il faut les transformer en un flot de liens cohérent.
Pour chaque message $m$, nous extrayons son auteur $a(m)$, l'instant $t(m)$ auquel le message a été posté\,\footnote{Cet instant est converti en $timestamp$ en tenant compte des fuseaux horaires.}, le message auquel il répond $p(m)$ trouvé via le champ \textsc{In-Reply-To}, son destinataire $a(p(m))$ et la discussion $D(m)$ dans laquelle il apparaît.
Pour les messages racines qui ne répondent à aucun autre, nous imposons $p(m)=m$.
L'ensemble de liens du flot est donc $\{(t(m),a(m),a(p(m)))\}_m$.
Nous ne prenons pas en compte la direction des liens.

Une fois le flot créé, il est encore nécessaire de vérifier sa cohérence.
Un message peut être filtré pour différentes raisons: le courriel apparaît avant le message auquel il est censé répondre, le message auquel il répond n'est pas présent dans l'archive, l'auteur et le destinataire sont la même personne.
Cette dernière condition permet notamment d'éviter la présence de boucles dans le flot.
Elle concerne principalement les racines.
Il s'agit de vérifications simples auxquelles il faut ajouter les vérifications sur la cohérence de la structure des discussions.
Ainsi, une discussion est entièrement retirée du jeu de données s'il manque sa racine ou si l'un de ses messages a été retiré à l'étape précédente.
Après ces vérifications, environ $7\%$ des discussions sont retirées.
Avec cela, il faut également tenir compte de notre temps d'observation qui est partiel.
En effet, une discussion dont le dernier message a lieu 1 semaine avant la fin de la capture peut ne pas être terminée.
De même, une discussion qui dure très longtemps n'a qu'une faible probabilité d'être capturée en entier.
Pour corriger ces biais, nous filtrons également les discussions ayant débutées trop récemment ou qui durent trop longtemps.
La limite pour considérer une discussion trop récente ou trop longue a été fixé à $4$ ans ($1.26\times 10^8 s$) car nous avons constaté qu'uniquement quelques discussions dépassent ce seuil sur la distribution de durées des discussions dans la figure~\ref{fig:dists_discussion}.
Toutes les discussions qui ont débutées moins de 4 ans avant le début de la capture du jeu de données ne sont donc pas prises en comptes.


Une fois tous ces messages filtrés, nous obtenons un flot de liens avec $316\ 569$ liens entre $34\ 648$ personnes pendant presque 19 ans et $116\ 999$ discussions.
Mis à part les $237\ 664$ messages de début de discussion, ce sont $168\ 482$ courriels qui ont été filtrés soit environ $23\%$.
La majorité des courriels filtrés l'ont été car ils appartiennent à une discussion trop récente.

\section{Caractéristiques élémentaires des discussions}

Les caractéristiques élémentaires des discussions sont le nombre de courriels, le nombre de personnes, le nombre de paires de personnes distinctes en interaction directe et leur durée.
Dans la figure~\ref{fig:dists_discussion}, sont présentées les distributions cumulatives inverses de ces quantités et on remarque: \emph{i)} elles sont toutes hétérogènes et \emph{ii)} les données filtrées ne diffèrent pas qualitativement des données brutes.

\begin{figure}
\centering
	\includegraphics[width=0.4\linewidth]{img/mailing/sizes-ccdf.eps}
	\includegraphics[width=0.4\linewidth]{img/mailing/durations-ccdf.eps}\\
	\includegraphics[width=0.4\linewidth]{img/mailing/authors-ccdf.eps}
	\includegraphics[width=0.4\linewidth]{img/mailing/authorpairs-ccdf.eps}
	
	\caption{Distribution cumulative inverse de différentes caractéristiques des les données brutes (ligne pleine) et filtrées (ligne en pointillé). En haut à gauche: nombre de courriels dans une discussion; en haut à droite: durée d'une discussion; en bas à gauche: nombre de personnes dans une discussion; en bas à droite: nombre de paires de personnes en interaction distinctes dans une discussion.}
	\label{fig:dists_discussion}
\end{figure}

La distribution des durées des discussions montre que la majorité des discussions dure environ une journée ou moins ($10^5$ secondes équivalent à moins de 28 heures).
Par ailleurs, il n'existe que quelques discussions qui durent plus d'un an.

Ces premières observations sont nécessaires mais pas suffisantes pour comprendre les caractéristiques d'une discussion.
Nous avons également étudié les corrélations entre ces différentes notions, lesquelles sont en partie présentées dans la figure~\ref{fig:corr_discussion}.


\begin{figure}
	\centering
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/sizes-durations-corr.eps}
		\caption{\label{fig:corr_discussion_duration}}		
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/sizes-authors-corr.eps}
		\caption{\label{fig:corr_discussion_author}}
	\end{subfigure}

	\caption{En (A): Corrélation entre le nombre de courriels et la durée d'une discussion. En (B): Corrélation entre le nombre de courriels et le nombre de personnes dans une discussion.}
	\label{fig:corr_discussion}
\end{figure}

Comme attendu, nous observons dans la figure~\ref{fig:corr_discussion_duration} que plus une discussion est grande en nombre de courriels plus elle dure longtemps, ce qui est attendu.
Par contre, on observe que les petites discussions ont des durées très variables. 
Dans la figure~\ref{fig:corr_discussion_author} présentant la corrélation entre le nombre de courriels et celui de personnes, nous observons un autre fait attendu~\cite{dorat2007}: une discussion est constituée, en général, de plus de messages que de participants.
Ainsi lors d'une discussion, c'est un petit nombre de personnes qui échangent potentiellement beaucoup de messages. 

Enfin, il est intéressant d'observer la dynamique des échanges entre chaque paire de personnes.
Soit $\tau(u,v) = \{t_{i+1}-t_i\}_{i=0..k+1}$ la séquence des temps inter-contacts des $k$ liens entre les n\oe{}uds $u$ et $v$, où $t_0$ est le temps entre $\alpha$ et le premier lien et $t_{k+1}$ est le temps entre le dernier lien et $\omega$.
Il s'agit du temps écoulé avant que deux personnes se contactent à nouveau, peu importe la conversation.
Dans la figure~\ref{fig:ict_discussion} est représentée la distribution cumulative inverse du temps inter-contacts dans le flot de liens. 
On observe que $21\%$ des temps inter-contacts sont inférieurs à 30 jours ($2.6\times 10^6 s$).
Ce chiffre bien que relativement faible est tout de même important car il s'agit de discussions ouvertes où tout le monde peut participer. 
En particulier, une personne peut envoyer une demande d'aide à un moment donné et ne plus jamais échanger avec les même personnes.
Or, $21\%$ des contacts directs sont renouvelés en moins de 30 jours.
La participation est donc relativement élevée.
\begin{figure}
	\centering
	\includegraphics[width=0.4\linewidth]{img/mailing/ict-ccdf.eps}
	\caption{Distribution des temps inter-contacts dans le flot de liens.}
	\label{fig:ict_discussion}
\end{figure}

\section{\'Etude des discussions en tant que sous-flots}
\label{etude_discussion}
\subsection{Application de la \texorpdfstring{$\Delta$}{delta}-densité}
\label{delta_densite}

Jusqu'à maintenant aucune notion intrinsèquement liée aux flots de liens n'a été utilisée pour caractériser les discussions.
Le but est d'évaluer si cette structure de flot peut se rapprocher d'une structure communautaire.
Comme dit précédemment, les communautés sont souvent définies comme des structures devant être densément connectées.
C'est pourquoi nous nous attachons à étudier la densité des discussions.

Ces données se modélisent par un flot de liens où les liens n'ont pas de durée, nous étudions donc la densité non pas dans le flot de liens initial mais dans $\sigma(\xi(L,\Delta))$ pour différentes valeurs de $\Delta$ entre 1 seconde et 20 ans.
La notation $\delta{\alpha..\omega}(\sigma(\xi(L,\Delta)))$ est cependant très lourde et nous la simplifions par $\delta_{\Delta}(L)$ et nous parlons donc de $\Delta$-densité.
Tout d'abord dans la figure~\ref{fig:dens_fil_discusion} est représentée la $\Delta$-densité globale du le flot.
En couvrant un spectre aussi large de $\Delta$, on observe que la $\Delta$-densité est croissante avec $\Delta$ mais surtout on observe bien la convergence de $\Delta$-densité vers $3.139\times 10^{-4}$, la densité du graphe agrégé, lorsque $\Delta$ est proche de $\omega - \alpha$.

\begin{figure}[h]
	\centering
	\includegraphics[width=0.4\linewidth]{img/mailing/global_loglog.eps}
	\caption{Évolution de la $\Delta$-densité (en vert) du flot de liens pour $\Delta$ de $60$ seconde à $20$ ans. En rouge, la densité dans le graphe agrégé.}
	\label{fig:dens_fil_discusion}
\end{figure}

Cependant, la $\Delta$-densité du flot n'apporte que peu d'informations en elle-même.
Elle est surtout utile pour comparer les valeurs de $\Delta$-densité des sous-flots que sont les discussions, c'est-à-dire $\delta(\sigma(\xi(D_i,\Delta)))$.
Ainsi dans la figure~\ref{fig:intra_dens_discussion}, est présentée la distribution cumulative inverse de la $\Delta$-densité des discussions pour différentes valeurs de $\Delta$.
On remarque que les différentes valeurs de $\Delta$ ne semblent pas influencer qualitativement la distribution de $\Delta$-densité.
Cette courbe met surtout en évidence que les discussions sont des structures beaucoup plus denses que le flot.
En effet, la densité médiane des discussions varie, selon la valeur de $\Delta$, entre $2.69 \times 10^{-4}$ et $0.28$ alors que le flot a une $\Delta$-densité variant entre $1.05  \times 10^{-10}$ et $3.14 \times 10^{-4}$.
La $\Delta$-densité des discussions est donc en moyenne $10^{5}$ fois plus élevée que celle du flot.
Bien que notable, ce fait est attendu notamment car le flot dure beaucoup plus longtemps et concerne beaucoup plus de n\oe{}uds que les discussions.
\begin{figure}
\centering
%\subfloat[Inverse cumulative distribution of intra-threads density.]{
	\includegraphics[width=0.4\linewidth]{img/mailing/delta.eps}
%}

\caption{Distribution cumulative inverse de la $\Delta$-densité des discussions pour différentes valeurs de $\Delta$.}
\label{fig:intra_dens_discussion}
\end{figure}

Afin d'aller plus loin dans l'étude de cette structure, il faut revenir à une définition plus précise de ce qu'est une bonne communauté.
En elle-même, une valeur de densité n'est pas suffisante pour définir une structure communautaire.
En effet, une discussion ayant une densité de $0.8$ peut ne pas être une communauté tandis qu'une autre ayant une densité proche de zéro peut être une communauté.
Il faut définir un point de comparaison pour effectivement affirmer qu'une structure est particulièrement dense.
La prise en compte de la densité globale est un début mais n'est pas suffisante.

Une autre définition d'une communauté est qu'elle devrait être plus densément connectée à l'intérieur qu'avec les autres communautés adjacentes.
Pour un graphe $G=(V,E)$ et une communauté $C_i$ de la partition $\mathcal{C} = \{C_j\}_{j_1..k}$ de $V$ en $k$ communautés, cela se traduit par le calcul de la densité entre les communautés, $\delta^{inter}(C_i)$ :

\begin{equation}
	\delta^{inter}(C_i) = \frac{1}{|C|-1}\sum_{j, i\ne j}\frac{|\{(u,v)\in E\mbox{ t.q. }u\in C_i\mbox{ et }v\in C_j\}|}{|C_i|\cdot |C_j|}.
\end{equation}
Il s'agit de la probabilité qu'un lien existe entre un n\oe{}ud de $C_i$ et un n\oe{}ud d'une autre communauté.
Encore une fois, cette notion n'a pas de sens direct dans le formalisme de flot de liens et il est nécessaire de l'adapter.
Pour ce faire, nous définissons la $\Delta$-densité inter-discussions entre deux discussions $D_i$ et $D_j$: $\delta^{inter}_{\Delta}(D_i,D_j)$.
Soient $\Delta_{ij}=\xi(D_i \cup D_j,\Delta)$ et $L_{inter}(D_i, D_j) = (T',V',E')$ avec:

\begin{itemize}
\item  $T'=[\beta(D_i \cup D_j) - \Delta/2,\psi(D_i \cup D_j) + \Delta/2]$, $V'= V(\Delta_{ij})$;
\item  $E' = \xi(E,\Delta) \setminus \Delta_{ij}$.
\end{itemize}
Avec ces notation, $\delta^{inter}_{\Delta}(D_i,D_j)$ est égale à:

\begin{equation}
 \delta^{inter}_{\Delta}(D_i,D_j) = \delta(L_{inter}(D_i, D_j))\, .
\end{equation}

Il s'agit donc de la densité du flot inter-discussions qui est constitué des liens entre les n\oe{}uds induits par $D_i$ et $D_j$ qui n'appartiennent ni à $D_i$ ni à $D_j$.
Dans la figure~\ref{fig:inter_dens_discussion_ex}, un exemple de flot inter-discussion est représenté.
Il est important de noter que le nombre de liens pris en compte dans le flot inter-discussions varie selon le $\Delta$ utilisé.

\begin{figure}
\centering
%\subfloat[Inverse cumulative distribution of inter-threads density.]{
	\includegraphics[width=0.65\linewidth]{img/mailing/inter_flot.eps}
%}
\caption{Exemple de flot inter-discussion.
Le flot entre les discussions \textcolor{olivegreen}{\textbf{verte}} et \textcolor{briquered}{\textbf{rouge}} est constitué des liens ou partie de liens en \textbf{noir}. Les liens en \textcolor{gray}{\textbf{gris}} ne sont pas pris en compte.}
\label{fig:inter_dens_discussion_ex}
\end{figure}



Afin d'obtenir la $\Delta$-densité inter-discussions entre $D_i$ et toutes les autres discussions, nous utilisons la moyenne des $\Delta$-densités inter-discussion entre $D_i$ et les autres discussions, soit:

\begin{equation}
	\delta^{inter}_{\Delta}(D_i) = \frac{1}{|C|-1}\sum_{j,i\ne j} \delta^{inter}_{\Delta}(D_i,D_j).
\end{equation}

La distribution cumulative inverse de la $\Delta$-densité inter-discussions est présentée dans la figure~\ref{fig:inter_dens_discussion} pour différentes valeurs de $\Delta$.
Bien que similaire, le comportement de la $\Delta$-densité inter-discussions diffère qualitativement de celui de la $\Delta$-densité.
La $\Delta$-densité inter-discussions croît aussi en fonction de $\Delta$ mais il y a toujours une différence notable entre $\Delta= 30\  jours$ et $\Delta= 1\ an$ ce qui n'est pas le cas pour la $\Delta$-densité.
Cette différence s'explique parce que quelque soit le $\Delta$, le nombre de liens considérés pour la $\Delta$-densité est fixe, au contraire, il croît avec $\Delta$ pour la $\Delta$-densité inter-discussion.
Cet effet est visible dans la figure~\ref{fig:inter_dens_discussion_ex}: le lien $(c,d)$ qui apparaît peu avant $\beta$ est en partie pris en compte, alors qu'il ne le serait pas avec un $\Delta$ plus proche de 0.

Un autre facteur est aussi la durée considérée qui est plus longue que la durée des discussions ce qui peut diminuer la densité.
\begin{figure}
\centering
%\subfloat[Inverse cumulative distribution of inter-threads density.]{
	\includegraphics[width=0.4\linewidth]{img/mailing/inter_delta.eps}
%}
\caption{Distribution cumulative inverse de la $\Delta$-densité inter-discussions pour différentes valeurs de $\Delta$ en secondes.}
\label{fig:inter_dens_discussion}
\end{figure}

\bigskip

Pour comparer aisément $\Delta$-densité et $\Delta$-densité inter-discussions, nous présentons dans la figure~\ref{fig:corel_inter_discussion} la corrélation entre ces deux mesures pour différentes valeurs de $\Delta$.
Nous remarquons que les discussions sont effectivement plus denses intérieurement qu'avec les autres discussions.
La différence est de plusieurs ordres de grandeur lorsque $\Delta$ est petit et elle diminue lorsque $\Delta$ croît.
Pour $\Delta=20\ ans$ dans la figure~\ref{fig:corel_inter_discussion_20}, la différence n'est plus visible car à cette échelle de temps, l'ancrage temporel des discussions n'est plus décisif.
On remarque tout de même que pour $\Delta=1\ an$, la différence reste notable.
 

\begin{figure}[h]
\centering
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/DensityCurve/120/mean.eps}
		\caption{$\Delta= $1 minute}		
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/DensityCurve/172800/mean.eps}
		\caption{$\Delta= $1 jour}		
	\end{subfigure}
	
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/DensityCurve/63072000/mean.eps}
		\caption{$\Delta= $1 an}		
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/DensityCurve/1261440000/mean.eps}
		\caption{$\Delta= $20 ans}	
		\label{fig:corel_inter_discussion_20}	
	\end{subfigure}

\caption{Corrélations entre $\Delta$-densité et $\Delta$-densité inter-discussions pour différentes valeurs de $\Delta$. Une discussion est en vert (resp. rouge) si elle a une $\Delta$-densité plus (resp. moins) élevée que sa $\Delta$-densité inter-discussions.}
\label{fig:corel_inter_discussion}
\end{figure}



\subsection{Répartition temporelle et structurelle des discussions}

Nous avons étudié la densité interne aux discussions et entre les discussions mais il est également intéressant d'observer comment ces discussions sont réparties topologiquement et temporellement.
Pour étudier la répartition des discussions dans le temps, nous construisons un graphe d'intervalle~\cite{Lekkeikerker} $X=(V_X,E_X)$ représentant le chevauchement temporel.
Chaque discussion du flot devient un n\oe{}ud de $V_X$ et le lien $(i,j)$ existe dans $E_X$ si les discussions $D_i$ et $D_j$ correspondantes se recouvrent temporellement, \emph{i.e.} $[\alpha_i, \omega_i] \cap [\alpha_j, \omega_j] \neq \emptyset$.
De manière similaire, nous définissons le graphe de chevauchement topologique $Y=(V_Y,E_Y)$.
Les n\oe{}uds de ce graphe représentent encore une fois les discussions du flot et un lien existe entre deux discussions si au moins une personne a participé aux deux, \emph{i.e.} $V(D_i) \cap V(D_j) \neq \emptyset$.

Par construction, ces graphes contiennent beaucoup d'information sur les relations entre les discussions.
Ces deux graphes sont constitués de 116 999 n\oe{}uds et d'environ 2 millions de liens pour le graphe de chevauchement temporel et d'environ 63 millions de liens pour le graphe de chevauchement topologique.



Dans la figure~\ref{fig:x-y-graphs_discu_temp}, est représentée la corrélation entre le degré d'une discussion dans le graphe de chevauchement temporel $X$ et sa durée.
Il y a une corrélation évidente entre ces deux notions lorsque les discussions ont une durée supérieure à $10^5$ secondes.
Plus une discussion dure longtemps, plus elle a de chance d'avoir lieu en même temps que d'autres discussions.
Nous observons également que, même pour les discussions durant moins d'un jour ($8.6 \times 10^4$\,s), il peut y avoir jusqu'à une centaine d'autres discussions actives sur la même période.

\begin{figure}
\centering
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/degree_temp}
		\caption{\label{fig:x-y-graphs_discu_temp}}		
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/degree_nodes}
		\caption{\label{fig:x-y-graphs_discu_node}}	
	\end{subfigure}
	
	
	\caption{En (A): Corrélation entre le degré des discussions dans le graphe de chevauchement temporel et leur durée. En (B): Corrélation entre le degré des discussions dans le graphe de chevauchement topologique et leur nombre de participants.}
	\label{fig:x-y-graphs_discu}
\end{figure}

La figure~\ref{fig:x-y-graphs_discu_node}  présente la corrélation entre le degré d'une discussion dans le graphe de chevauchement topologique $Y$ et son nombre de participants.
La corrélation est moins nette mais il y a tout de même une tendance.
Par contre, nous remarquons de manière frappante que même une petite discussion peut partager des n\oe{}uds avec énormément d'autres discussions.


\subsection{Flot quotient}


Le graphe quotient, qui est équivalent au graphe de chevauchement topologique, est une autre notion clef pour étudier les relations entre les communautés d'un graphe $G=(V,E)$.
Soit une partition $C= \{C_i\}_{1 .. k}$ des n\oe{}uds de $G$ en $k$ communautés, chaque communauté est représentée dans le graphe quotient $\bar{G}$ par un n\oe{}ud dans $V$.
Il y a un lien entre deux communauté $C_i$ et $C_j$ dans $E$ s'il existe au moins un lien entre un n\oe{}ud de $C_i$ et un n\oe{}ud de $C_j$.
Voir une illustration sur la figure~\ref{fig:graph-quotient}.
Il est possible d'ajouter un poids sur les liens de $\bar{G}$ égal au nombre de liens reliant les communautés.
Le graphe quotient permet de facilement étudier, dans un graphe, les relations entre les communautés.

\begin{figure}
\centering
	\includegraphics[width=0.50\linewidth]{img/mailing/graph-quotient}
	\vfill
	\includegraphics[width=0.75\linewidth]{img/mailing/stream-quotient}
	\caption{Haut: Exemple de graphe ayant une structure communautaire et son graphe quotient associé. Bas: Exemple d'un flot de lien avec une structure ainsi que son flot quotient associé.}
	\label{fig:graph-quotient}
%\label{fig:corel_inter}
\end{figure}

Nous étendons maintenant cette notion de graphe quotient aux flots de liens.
Nous définissons le flot quotient, $Q=(T_Q,V_Q,E_Q)$, induit par une partition $P=\{{P_i}\}_{1..k}$ en $k$ sous-flots de la manière suivante: chaque sous-flot $P_i$ est représenté par un n\oe{}ud dans $V_Q$.
Il existe un lien $(t_2,P_i,P_j)$ dans $E_Q$ s'il existe $(t_1,u,v) \in P_i$, $(t_2,u,v') \in P_j$ et $(t_3,u,v'') \in P_i$ avec $t_1 \leq t_2 \leq t_3$.
En d'autre termes, il y a un lien dans $E_Q$ si un n\oe{}ud $u$ a un lien dans $P_j$ qui apparaît entre deux autres de ses liens du groupe $P_i$.

Le flot quotient induit par les discussions dans le jeu de données contient $12\ 281\ 269$ liens impliquant $68\ 524$ discussions différentes.
Comme le jeu de données contient $116\ 999$ discussions, il y a donc $48\ 475$ discussions sans lien et qui ne seront pas prises en compte par la suite.
Ce nombre de discussions non-reliées est élevé comparé à ce qui pourrait être obtenu dans un graphe quotient.
En effet dans un graphe, un n\oe{}ud de degré $0$ correspond à une communauté qui est une composante connexe.
En ajoutant l'information temporelle, des discussions liées par leurs participants peuvent être séparées par le temps et les n\oe{}uds les représentant dans le flot ne seront alors pas liés.
Ce phénomène est d'autant plus vrai pour les discussions courtes.



Il faut aussi noter qu'il y a environ 20 fois plus de liens dans le flot quotient que dans le flot initial.
Cela s'explique par le fait qu'un lien dans le flot peut donner lieu à plusieurs liens dans le flot quotient.
Ce cas est visible dans la figure~\ref{fig:graph-quotient}. 
Le lien $(x,y)$ du groupe violet du flot à gauche donne lieu au lien $(\textcolor{plum}{violet}, \textcolor{red}{rouge})$ et au lien $(\textcolor{plum}{violet}, \textcolor{oliveGreen}{vert})$ dans le flot quotient à droite. 

\begin{figure}
\centering
	\includegraphics[width=0.4\linewidth]{img/mailing/quotient-density}
	\caption{$\Delta$-densité du flot de liens et du flot de liens quotient en fonction de $\Delta$ pour $\Delta=1mn, 1h, 12h, 1j, 7j, 30j, 1\ an$ et $20\ ans$.}
	\label{fig:quotient-stream-density}
\end{figure}

La figure~\ref{fig:quotient-stream-density} présente la $\Delta$-densité du flot de liens initial et du flot quotient pour différentes valeurs de $\Delta$.
Le flot initial et le flot quotient ont le même comportement de densité mais le flot quotient est moins $\Delta$-dense que le flot initial.
Ce résultat diffère de ce qui pourrait être obtenu avec un graphe quotient.
Cela est dû au nombre de n\oe{}uds qui est beaucoup plus important dans le flot quotient que dans le flot original, même si, le degré moyen dans le flot quotient est en moyenne 25 fois plus élevé que dans le flot original.


\section{Détection de structures denses}

\`A partir du constat que les discussions forment une structure particulière, il est naturel d'essayer de les retrouver automatiquement. 
Pour y parvenir, il faut un moyen capable de trouver des sous-flots denses dans le flot.
C'est à dire une méthode identifiant des groupes de liens qui soient proches temporellement et topologiquement.
Il serait tentant d'optimiser directement la densité dans le flot mais ce n'est pas envisageable car un groupe constitué d'un unique lien a une densité de $1$.
Il faut donc trouver une autre méthode.
C'est pourquoi nous avons construit une autre projection du flot en un graphe statique afin d'y appliquer une méthode de détection de communautés.
L'enjeu est alors de réussir à créer une transformation de telle sorte que les informations temporelles et topologiques ne soient pas complètement perdues.

\subsection{Méthode de détection}
\label{sec:fail_mailing}
Afin de créer une transformation du flot vers un graphe, nous définissons un autre flot de liens, $\mathfrak{L}$, dont les liens ont une durée.
\`A partir de $\mathfrak{L}$, nous créons un graphe non-orienté et non-pondéré $\mathcal{G} = (\mathcal{V},\mathcal{E})$. Nous commençons par décrire comment $\mathcal{G}$ est défini à partir de $\mathfrak{L}$.

Chaque un n\oe{}ud de $\mathcal{G}$ correspond à lien de $\mathfrak{L}$.
Deux liens $(b,e,u,v)$ et $(b',e',u',v')$ du flot de liens sont reliés dans $\mathcal{G}$ s'ils partagent un n\oe{}ud et si les intervalles s'intersectent, \emph{i.e.} $\{u,v\} \cap \{u',v'\} \neq \emptyset$ et $[b,e]\cap[b',e'] \neq \emptyset$ (voir la figure~\ref{fig:Transformation}).
Ainsi, un lien dans le graphe représente une connexion structurelle et temporelle entre deux liens du flot de liens.
Les groupes denses dans $\mathcal{G}$ représentent donc des groupes de liens connectés temporellement et topologiquement dans $\mathfrak{L}$.

\begin{figure}[h]
\centering
\includegraphics[width=0.55\linewidth]{img/mailing/Transformation.eps}
\caption{Transformation d'un flot de liens avec 4 n\oe{}uds (a-d) et 6 liens à gauche en un graphe à droite à 6 n\oe{}uds. La couleur d' un n\oe{}ud dans le graphe indique le lien du flot qu'il représente.}
\label{fig:Transformation}
\end{figure}%

Nous étudions maintenant comment ajouter une durée à chaque lien pour créer $\mathfrak{L}$.
Lors du calcul de la densité dans la section~\ref{delta_densite}, nous avions ajouté une durée arbitraire $\Delta$.
Ici, il n'est pas très pertinent d'appliquer la même logique.
En effet, si on utilise un $\Delta$ faible, alors il n'y aura que très peu de liens dans $\mathcal{G}$ et les n\oe{}uds représentant les liens d'une discussions ne seront pas forcément reliés.
Il parait illusoire d'espérer retrouver les discussions dans $\mathcal{G}$ si elles n'appartiennent pas à la même composante connexe.
Si $\Delta$ est très grand alors toute information temporelle est perdue et cela revient à calculer le \emph{line-graph}\,\footnote{Nous définissons le \emph{line-graph} dans le chapitre~\ref{chap:Expected_Node}.} du multigraphe agrégé.
C'est pourquoi nous adoptons une autre manière d'ajouter une durée sur les liens.

Pour chaque message $m$, nous connaissons $p(m)$, le message auquel il répond dans la discussion.
Nous définissons alors les liens de $\mathfrak{L}$ qui ont une durée de la manière suivante: ${(t(p(m)),t(m),a(m),a(p(m))}_m$.
Ainsi, deux messages $m_1$ et $m_2$ se succédant dans une discussion sont par définition reliés topologiquement car $a(m_1)= a(p(m_2))$.
Ces deux messages sont aussi reliés temporellement car nous avons la relation suivante:
\begin{align*}
[t(p(m_1)),t(m_1)]\cap [\mathbf{t(p(m_2))},t(m_2)] &= \\
[t(p(m_1)),t(m_1)]\cap [\mathbf{t(m_1)},t(m_2)] &= [t(m_1)] \neq \emptyset.
\end{align*}
Par construction, une discussion est donc représentée dans $\mathcal{G}$ par un ensemble connexe de n\oe{}uds.
Un fois $\mathcal{G}$ construit, on peut appliquer un algorithme de détection de communautés.

Avec cette construction, $\mathcal{G}$ contient plus d'1 millions de liens entre 316 569 n\oe{}uds pour les 116 999 discussions présentes.
Sur ce graphe, nous avons appliqué l'algorithme de Louvain~\cite{Blondel2008a} qui optimise la modularité.
D'autres algorithmes peuvent être appliqués s'ils détectent des groupes de n\oe{}uds disjoints et s'ils passent à l'échelle.
Les groupes trouvés par Louvain sont des communautés dans $\mathcal{G}$.
Par conséquent, ils sont censé être densément connectés dans $\mathcal{G}$.
Comme un lien de $\mathcal{G}$ correspond à une connexion temporelle et topologique dans le flot, on peut espérer qu'ils correspondent à des groupes denses dans le flot.
C'est ce que nous cherchons à montrer ensuite.

\subsection{Comparaison des partitions}

Avant de comparer la structure des discussions, $D$, et la partition, $\mathfrak{D}$, trouvée par la méthode de Louvain sur $\mathcal{G}$, il est nécessaire de décrire cette dernière.
Dans la figure~\ref{fig:carac_mail_louvain}, les distributions cumulatives inverses du nombre de liens, du nombre n\oe{}uds et de leur durée sont présentées pour les groupes de $\mathfrak{D}$.
Pour rappel, les même données sont représentées pour les discussions.
On remarque tout de suite que $\mathfrak{D}$ contient des groupes beaucoup plus gros en nombre de n\oe{}uds et de liens alors qu'ils ont des durées similaires.
\begin{figure}[h]
\centering
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/linksize}\hfill
		\caption{}		
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/nodeSize}\hfill
		\caption{}		
	\end{subfigure}

	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/duree}\hfill
		\caption{}		
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/densite}
		\caption{\label{fig:dens_mail_louvain}}		
	\end{subfigure}
\caption{Distributions cumulatives inverses du nombre de liens (A), du nombre de n\oe{}uds (B), de la durée (C) et de la densité (D) pour les groupes trouvés par Louvain et les discussions.}
\label{fig:carac_mail_louvain}
\end{figure}



Ces deux structures sont donc très différentes mais cela pourrait être dû à l'algorithme de Louvain qui n'est pas adapté pour trouver des groupes denses.
C'est pourquoi nous avons également observé la densité des groupes de $D$ et $\mathfrak{D}$ dans le flot $\mathfrak{L}$.
Le résultat est visible dans la figure~\ref{fig:dens_mail_louvain}.
Comme les liens de $\mathfrak{L}$ ont une durée, il est possible d'utiliser directement la densité au lieu de la $\Delta$-densité utilisée précédemment.
On remarque que les groupes de $\mathfrak{D}$, bien que plus gros, sont plus denses que les groupes de $D$.
Cependant la distribution cumulative inverse cache les effets de la taille sur la densité.
Or, une analyse manuelle montre qu'à nombre de liens égal (entre $2$ et $160$) les groupes trouvés par Louvain sont plus denses en moyenne, $0.46$ contre $0.38$. 
La médiane est également légèrement plus élevée: $0.34$ contre $0.33$.
En revanche, les plus gros groupes ($\mathcal{D}_j|>160$) trouvés par Louvain ont une densité plus faible ce qui peut être dû à leur taille.

Si les groupes de $\mathfrak{D}$ sont plus denses, c'est peut-être car ils regroupent plusieurs discussions de $D$ dans un groupe.
Pour comparer deux partitions, l'indice de Jaccard est classiquement utilisé pour calculer la précision et le rappel qui sont définis de la manière suivante:

\begin{equation*}
pr\acute{e}cision(\mathfrak{D}_j)= \max_{i} \frac{|\mathfrak{D}_j \cap D_i|}{|\mathfrak{D}_j|}\,, \quad \qquad
rappel(D_i)= \max_{j} \frac{|\mathfrak{D}_j \cap D_i|}{|D_i|}.
\label{eq:rappel}
\end{equation*}

Dans la figure~\ref{fig:rec_inclusion_niveau0}, sont présentées la précision des groupes capturés et le rappel des discussions en fonctions de leur taille.
Chaque point représente la moyenne de la précision (resp. rappel) pour les groupes (resp. discussions) d'une taille donnée.
On voit qu'il y a un important rappel et ce même pour les grandes discussions, ce qui veut dire qu'en général une discussion $D_i$ est totalement incluse dans un groupe $\mathfrak{D}_j$.
En revanche, la précision est très faible car un groupe $\mathfrak{D}_j$ contient plusieurs discussions, ce qui est cohérent avec la taille très importante des groupes de $\mathfrak{D}_j$.

\begin{figure}
\centering

\hfill
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/Rappel_0.eps}
		\caption{}		
	\end{subfigure}\hfill
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/Precision_0.eps}
		\caption{}		
	\end{subfigure}\hfill

\caption{(A) Rappel des discussions vis-à-vis des groupes trouvés par Louvain.
 (B) Précision des groupes trouvés vis-à-vis des discussions.
Chaque point représente la moyenne du rappel (resp. précision) pour les discussions (resp. groupes) ayant la même taille.
La couleur du point indique le nombre de groupes ayant la même taille.}
\label{fig:rec_inclusion_niveau0}
\end{figure}


Il semble donc que la partition $\mathfrak{D}$ soit proche de $D$ mais que ses groupes soient plus gros.
Pour circonvenir à ce problème, nous appliquons de manière récursive l'algorithme de Louvain sur chaque graphe induit par un groupe $\mathfrak{D}_j$.
Ce processus permet de subdiviser chaque groupe $\mathfrak{D}_j$.
Le niveau $0$ est la première partition trouvée par l'algorithme de Louvain dans $\mathcal{G}$, c'est-à-dire $\mathfrak{D}_{0,j}=\mathfrak{D}_j$.
Soit $\mathfrak{D}_{h,j'}$ un groupe trouvé au niveau $h$, par construction, il est inclus dans un groupe trouvé au niveau $h-1$, c'est à dire $\mathfrak{D}_{h,j'} \subseteq \mathfrak{D}_{h-1,j}$.


Soit $D_i \in D$, notons $\mathfrak{D}_{h,\tilde{i}}$ le groupe trouvé par la méthode de Louvain au niveau $h$ qui soit le plus proche de $D_i$, c'est-à-dire $|\mathfrak{D}_{h,\tilde{i}}\cap D_i|= \max_{j} |\mathfrak{D}_{h,j} \cap D_i|$.
Avec ces définitions, on observe la relation suivante: $\mathfrak{D}_{h,\tilde{i}}\cap D_i \subseteq \mathfrak{D}_{h-1,\tilde{i}}\cap D_i$.
La définition de rappel de l'équation~\ref{eq:rappel} n'est donc pas adaptée pour les niveaux inférieurs et nous l'adaptons de la manière suivante:

\begin{equation}
rappel(D_i,h)= \max_{j} \frac{|\mathfrak{D}_{h,j} \cap D_i|}{|D_i \cap \mathfrak{D}_{h-1,\tilde{j}}|}.
\end{equation}

Ainsi, le rappel au niveau $h$ prend en compte le maximum d'élément qu'il est possible de trouver à ce niveau.
La définition de précision ne pose quant à elle pas de problème.
La figure~\ref{fig:rec_inclusion} représente le rappel adapté et la précision pour le premier et deuxième niveau de récursion de la même manière que pour la figure~\ref{fig:rec_inclusion_niveau0}.
On remarque que, dès le premier niveau, le rappel baisse et que ce phénomène s'amplifie fortement au niveau suivant.
Cela implique que les discussions ne sont plus incluses dans un groupe mais au contraire réparties dans plusieurs.
La précision quant à elle augmente légèrement mais cela est dû à la baisse de la taille des groupes trouvés.
Il semble donc qu'il ne soit pas possible avec cette approche de retrouver automatiquement les discussions.


\begin{figure} [h]
\centering

	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/Rappel_1.eps}
		\caption{niveau 1}		
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/Precision_1.eps}
		\caption{niveau 1}		
	\end{subfigure}
	
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/Rappel_2.eps}
		\caption{niveau 2}		
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\linewidth]{img/mailing/Detection/Precision_2.eps}
		\caption{niveau 2}		
	\end{subfigure}

\caption{(A,C) Rappel des discussions vis-à-vis des groupes trouvés par Louvain à différent niveaux récursifs.
(B,D) Précision des groupes trouvés vis-à-vis des discussions.
Chaque point représente la moyenne du rappel (resp. précision) pour les discussions (resp. groupes) ayant la même taille.
La couleur du point indique le nombre de groupes ayant la même taille.
}
\label{fig:rec_inclusion}
\end{figure}

\subsection{Conclusion et perspectives}

\subsubsection{Conclusion}

Nous avons utilisé le modèle de flot de liens pour étudier une archive de courriels provenant du projet Debian.
Grâce au modèle de flot de liens, nous avons proposé des notions clefs pour mieux comprendre la répartition temporelle et topologique des discussions.
Nous avons notamment étudié la notion de $\Delta$-densité sur les discussions en elles mêmes.
Puis, nous avons étudié les relations entre les discussions avec la $\Delta$-densité inter-discussions, les projections en graphes de chevauchement temporel ou topologique et le flot quotient.

Cette étude repose en grande partie sur la notion de $\Delta$-densité qui nécessite de fixer arbitrairement $\Delta$.
Nous avons à chaque fois testé un ensemble de valeurs de $\Delta$ variant d'une seconde jusqu'à parfois 20 ans et, lors de ces tests, aucune valeur $\Delta$ caractéristique n'a pu être identifiée.
La $\Delta$-densité est donc relativement robuste vis-à-vis de $\Delta$ dans ce jeu de données.

Ces métriques nous ont permis d'observer que les discussions forment une structure plus dense que le flot de liens.
De manière encore plus forte, nous avons constaté, grâce à la $\Delta$-densité inter-discussion, que les discussions sont plus denses en interne qu'en externe.
C'est une caractéristique importante des communautés que l'on trouve dans les graphes mais qui n'avait pas encore été observée dans un contexte temporel.
Forts de ces découvertes, nous avons poursuivi la recherche par l'étude des relations à un niveau plus macro: celles entre les discussions.
Via le graphe de chevauchement temporel, nous avons validé le fait que différentes discussions ont lieu en même temps et que par conséquent une agrégation temporelle entraînerait une perte d'information.
De même via le graphe de chevauchement topologique, nous avons mis en évidence une structure très recouvrante sur les n\oe{}uds, rendant l'utilisation de partitions statiques de n\oe{}uds difficilement envisageable pour décrire les discussions.


Par la suite, nous avons mis en place un première méthode de détection de partition de liens.
Cette méthode se base sur la projection du flot de liens en un graphe statique sur lequel nous appliquons un algorithme de détection de communautés provenant de la théorie des graphes.
Nous avons, avec cette méthode, mis en évidence des groupes denses.
Les groupes trouvés sont plus gros et plus denses que la structure des discussions mais les incluant.
Il semble donc qu'il existe une autre structure pertinente que celle des discussions et il serait intéressant de mettre au jour son sens.

Ces observations ne remettent d'ailleurs pas en cause les conclusions faites sur les discussions, pour plusieurs raisons.
Tout d'abord, les flots de liens étudiés ne sont pas exactement les-mêmes ($L\neq \mathfrak{L}$).
Ce changement de flot est nécessaire pour le fonctionnement de la méthode de détection mais cela change l'objet d'étude.
Ensuite, les deux structures ne sont pas complètement différentes car les groupes trouvés semblent en fait agréger plusieurs discussions.
Malheureusement, nous n'avons pas réussi avec notre méthode à isoler chaque discussion malgré notre approche récursive.
Pourtant, il semble que la structure trouvée ait du sens au vu des valeurs de densité des groupes.

\subsubsection{Perspectives}

Ce jeux de données de courriels est intéressant.
D'une part, il couvre une très longue période de temps et, d'autre part, il existe de nombreuses informations associées.
Nous avons utilisé ici la connaissance de la discussion associée à chaque courriel pour étudier la notion de communautés.
D'autres notions pourraient être développées grâce sur ce jeu de données, notamment les notions de centralité et de rôle des n\oe{}uds.
Grâce à la durée de presque $20$ ans du jeu de données, il serait intéressant de mesurer l'évolution de l'implication et du rôle d'une personne.
Il serait ainsi possible de mieux comprendre la participation de personnes à un projet de cette ampleur.

Il y a également le texte brut du mail qui est accessible et dont nous n'avons pas tiré parti.
Il serait sûrement intéressant pour des linguistes de quantifier l'évolution du vocabulaire.
De même, nous nous sommes focalisés sur la liste de discussion anglaise, alors qu'il est possible avec le script d'extraction de considérer les listes de discussions dans d'autres langues.
Il pourrait être intéressant de comparer les structures obtenues pour différentes langues.

\bigskip



Lors la manipulation de flot de liens, un enjeu important est la compréhension de la structure de liens que nous avons détectée.
C'est cette perspective que nous poursuivons dans le chapitre suivant.

